<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Portfolio | Tu Patrimonio</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
</head>
<body class="theme-light">
    <!-- Pantalla de carga -->
    <div id="loading-screen" class="loading-screen">
        <div class="loader">
            <div class="loader-ring"></div>
            <span class="loader-text">Cargando...</span>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-gem"></i>
                <span>Wealth Portfolio</span>
            </div>
            <div class="header-actions">
                <button id="theme-toggle" class="btn-icon" title="Cambiar tema">
                    <i class="fas fa-moon"></i>
                </button>
                <div id="user-info" class="user-info hidden">
                    <span id="user-name"></span>
                    <button id="logout-btn" class="btn-secondary">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal Login/Register -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-modal-content">
            <div class="auth-header">
                <i class="fas fa-gem auth-icon"></i>
                <h2>Bienvenido</h2>
                <p>Gestiona tu patrimonio con elegancia</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Iniciar Sesión</button>
                <button class="auth-tab" data-tab="register">Registrarse</button>
            </div>

            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="login-user">Usuario</label>
                    <input type="text" id="login-user" required placeholder="Tu usuario">
                </div>
                <div class="form-group">
                    <label for="login-password">Contraseña</label>
                    <input type="password" id="login-password" required placeholder="••••••••">
                </div>
                <button type="submit" class="btn-primary btn-full">
                    <span>Ingresar</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>

            <form id="register-form" class="auth-form hidden">
                <div class="form-group">
                    <label for="register-user">Usuario</label>
                    <input type="text" id="register-user" required placeholder="Elige un usuario">
                </div>
                <div class="form-group">
                    <label for="register-password">Contraseña</label>
                    <input type="password" id="register-password" required minlength="6" placeholder="Mínimo 6 caracteres">
                </div>
                <button type="submit" class="btn-primary btn-full">
                    <span>Crear Cuenta</span>
                    <i class="fas fa-user-plus"></i>
                </button>
            </form>

            <div id="auth-error" class="auth-error hidden"></div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <main id="main-content" class="main-content hidden">
        
        <!-- 1. MERCADO HOY -->
        <section class="market-section">
            <div class="container">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Mercado Hoy
                </h2>
                
                <!-- Acciones principales (fijas) -->
                <div class="market-subsection">
                    <h4 class="market-subtitle">Principales</h4>
                    <div id="market-ticker-main" class="market-ticker">
                        <div class="ticker-item loading">
                            <span class="ticker-symbol">Cargando...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Acciones personalizadas -->
                <div class="market-subsection">
                    <div class="market-subtitle-row">
                        <h4 class="market-subtitle">Mis Favoritas</h4>
                        <button id="edit-favorites-btn" class="btn-small" title="Editar favoritas">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                    <div id="market-ticker-custom" class="market-ticker">
                        <div class="ticker-item empty">
                            <span class="ticker-symbol">Seleccioná tus acciones favoritas</span>
                        </div>
                    </div>
                    
                    <!-- Selector de favoritas (oculto por defecto) -->
                    <div id="favorites-selector" class="favorites-selector hidden">
                        <div class="favorites-selector-content">
                            <label>Elegí hasta 5 acciones:</label>
                            <select id="favorite-stocks-select" multiple>
                                <optgroup label="Argentina">
                                    <option value="GGAL.BA">GGAL - Grupo Galicia</option>
                                    <option value="YPF.BA">YPF - YPF S.A.</option>
                                    <option value="BBAR.BA">BBAR - Banco BBVA</option>
                                    <option value="BMA.BA">BMA - Banco Macro</option>
                                    <option value="PAMP.BA">PAMP - Pampa Energía</option>
                                    <option value="TXAR.BA">TXAR - Ternium</option>
                                    <option value="ALUA.BA">ALUA - Aluar</option>
                                    <option value="CEPU.BA">CEPU - Central Puerto</option>
                                    <option value="TECO2.BA">TECO2 - Telecom</option>
                                    <option value="EDN.BA">EDN - Edenor</option>
                                </optgroup>
                                <optgroup label="CEDEARs - Tech">
                                    <option value="AAPL.BA">AAPL - Apple</option>
                                    <option value="GOOGL.BA">GOOGL - Google</option>
                                    <option value="MSFT.BA">MSFT - Microsoft</option>
                                    <option value="AMZN.BA">AMZN - Amazon</option>
                                    <option value="TSLA.BA">TSLA - Tesla</option>
                                    <option value="META.BA">META - Meta</option>
                                    <option value="NVDA.BA">NVDA - Nvidia</option>
                                    <option value="NFLX.BA">NFLX - Netflix</option>
                                </optgroup>
                                <optgroup label="CEDEARs - ETFs">
                                    <option value="SPY.BA">SPY - S&P 500</option>
                                    <option value="QQQ.BA">QQQ - Nasdaq 100</option>
                                    <option value="DIA.BA">DIA - Dow Jones</option>
                                    <option value="EEM.BA">EEM - Emerging Markets</option>
                                </optgroup>
                                <optgroup label="CEDEARs - Otros">
                                    <option value="MELI.BA">MELI - MercadoLibre</option>
                                    <option value="GLOB.BA">GLOB - Globant</option>
                                    <option value="KO.BA">KO - Coca Cola</option>
                                    <option value="MCD.BA">MCD - McDonald's</option>
                                    <option value="JPM.BA">JPM - JP Morgan</option>
                                    <option value="V.BA">V - Visa</option>
                                </optgroup>
                            </select>
                            <button id="save-favorites-btn" class="btn-primary btn-small">
                                <i class="fas fa-save"></i> Guardar
                            </button>
                        </div>
                    </div>
                </div>
                
                <p id="market-update-time" class="market-update-time"></p>
            </div>
        </section>

        <!-- 2. RESUMEN DEL PORTFOLIO -->
        <section class="hero-section">
            <div class="container">
                <div class="portfolio-summary">
                    <div class="summary-card main-value">
                        <span class="summary-label">Patrimonio Total</span>
                        <span id="total-value-ars" class="summary-value"><span class="currency-label">ARS</span> 0</span>
                        <span id="total-value-usd" class="summary-secondary"><span class="currency-label">USD</span> 0</span>
                    </div>
                    <div class="summary-cards-row">
                        <div class="summary-card">
                            <span class="summary-label">Inversión Total</span>
                            <span id="total-invested" class="summary-value small"><span class="currency-label">ARS</span> 0</span>
                            <span id="total-invested-usd" class="summary-secondary"><span class="currency-label">USD</span> 0</span>
                        </div>
                        <div class="summary-card profit-card">
                            <span class="summary-label">Ganancia / Pérdida</span>
                            <div class="profit-container">
                                <div class="profit-row profit-ars-row">
                                    <span class="profit-currency-tag">ARS</span>
                                    <span id="total-profit" class="profit-value profit">+0</span>
                                    <span id="total-profit-percent" class="profit-percent profit">(0%)</span>
                                </div>
                                <div class="profit-row profit-usd-row">
                                    <span class="profit-currency-tag">USD</span>
                                    <span id="total-profit-usd" class="profit-value-usd profit">+0.00</span>
                                    <span id="total-profit-usd-percent" class="profit-percent-usd profit">(0%)</span>
                                </div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <span class="summary-label">Cotización USD</span>
                            <div class="usd-rates">
                                <div class="usd-rate">
                                    <span class="usd-rate-label">Blue</span>
                                    <span id="current-usd-blue" class="usd-rate-value"><span class="currency-label">ARS</span> 0</span>
                                </div>
                                <div class="usd-rate">
                                    <span class="usd-rate-label">Oficial</span>
                                    <span id="current-usd-oficial" class="usd-rate-value"><span class="currency-label">ARS</span> 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. NUEVA COMPRA / NUEVA VENTA -->
        <section class="transaction-section">
            <div class="container">
                <!-- Tabs para Compra/Venta -->
                <div class="transaction-tabs">
                    <button class="transaction-tab active" data-type="buy">
                        <i class="fas fa-plus-circle"></i>
                        Nueva Compra
                    </button>
                    <button class="transaction-tab" data-type="sell">
                        <i class="fas fa-minus-circle"></i>
                        Nueva Venta
                    </button>
                </div>
                
                <!-- Formulario de COMPRA -->
                <form id="buy-form" class="transaction-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="buy-stock-select">Acción</label>
                            <select id="buy-stock-select" required>
                                <option value="">Seleccionar acción...</option>
                                <optgroup label="Argentina - Bancos">
                                    <option value="GGAL.BA">GGAL - Grupo Galicia</option>
                                    <option value="BBAR.BA">BBAR - Banco BBVA</option>
                                    <option value="BMA.BA">BMA - Banco Macro</option>
                                    <option value="SUPV.BA">SUPV - Supervielle</option>
                                    <option value="VALO.BA">VALO - Grupo Valores</option>
                                    <option value="BYMA.BA">BYMA - Bolsas y Mercados</option>
                                </optgroup>
                                <optgroup label="Argentina - Energía">
                                    <option value="YPF.BA">YPF - YPF S.A.</option>
                                    <option value="PAMP.BA">PAMP - Pampa Energía</option>
                                    <option value="CEPU.BA">CEPU - Central Puerto</option>
                                    <option value="TGSU2.BA">TGSU2 - TGS</option>
                                    <option value="TGNO4.BA">TGNO4 - TGN</option>
                                    <option value="EDN.BA">EDN - Edenor</option>
                                </optgroup>
                                <optgroup label="Argentina - Industria">
                                    <option value="TXAR.BA">TXAR - Ternium Argentina</option>
                                    <option value="ALUA.BA">ALUA - Aluar</option>
                                    <option value="LOMA.BA">LOMA - Loma Negra</option>
                                    <option value="MIRG.BA">MIRG - Mirgor</option>
                                </optgroup>
                                <optgroup label="Argentina - Otros">
                                    <option value="CRES.BA">CRES - Cresud</option>
                                    <option value="TECO2.BA">TECO2 - Telecom</option>
                                    <option value="COME.BA">COME - Soc. Comercial del Plata</option>
                                    <option value="IRSA.BA">IRSA - IRSA</option>
                                </optgroup>
                                <optgroup label="CEDEARs - ETFs">
                                    <option value="QQQ.BA">QQQ - Invesco QQQ (Nasdaq 100)</option>
                                    <option value="SPY.BA">SPY - SPDR S&P 500</option>
                                    <option value="DIA.BA">DIA - SPDR Dow Jones</option>
                                    <option value="EEM.BA">EEM - iShares Emerging Markets</option>
                                </optgroup>
                                <optgroup label="CEDEARs - Tecnología">
                                    <option value="AAPL.BA">AAPL - Apple</option>
                                    <option value="GOOGL.BA">GOOGL - Google</option>
                                    <option value="MSFT.BA">MSFT - Microsoft</option>
                                    <option value="AMZN.BA">AMZN - Amazon</option>
                                    <option value="TSLA.BA">TSLA - Tesla</option>
                                    <option value="META.BA">META - Meta</option>
                                    <option value="NVDA.BA">NVDA - Nvidia</option>
                                    <option value="NFLX.BA">NFLX - Netflix</option>
                                </optgroup>
                                <optgroup label="CEDEARs - Consumo">
                                    <option value="MCD.BA">MCD - McDonald's</option>
                                    <option value="KO.BA">KO - Coca Cola</option>
                                    <option value="PEP.BA">PEP - PepsiCo</option>
                                    <option value="WMT.BA">WMT - Walmart</option>
                                    <option value="DIS.BA">DIS - Disney</option>
                                </optgroup>
                                <optgroup label="CEDEARs - Finanzas">
                                    <option value="JPM.BA">JPM - JP Morgan</option>
                                    <option value="V.BA">V - Visa</option>
                                    <option value="MA.BA">MA - Mastercard</option>
                                    <option value="GS.BA">GS - Goldman Sachs</option>
                                </optgroup>
                                <optgroup label="CEDEARs - Latinoamérica">
                                    <option value="MELI.BA">MELI - MercadoLibre</option>
                                    <option value="GLOB.BA">GLOB - Globant</option>
                                    <option value="NU.BA">NU - Nubank</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="buy-date">Fecha de Compra</label>
                            <input type="date" id="buy-date" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="buy-quantity">Cantidad de Acciones</label>
                            <input type="number" id="buy-quantity" min="0.01" step="0.01" required placeholder="Ej: 10">
                        </div>
                        <div class="form-group">
                            <label for="buy-price">Precio por Acción (ARS)</label>
                            <input type="number" id="buy-price" min="0" step="0.01" required placeholder="Ej: 15000">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="buy-exchange-rate">Cotización USD del día</label>
                            <div id="buy-dolar-type-container" class="dolar-type-container hidden">
                                <div class="dolar-options">
                                    <label class="dolar-option">
                                        <input type="radio" name="buy-dolar-type" value="blue" checked>
                                        <span class="dolar-option-label">
                                            <span class="dolar-name">Blue</span>
                                            <span id="buy-dolar-blue-value" class="dolar-value">-</span>
                                        </span>
                                    </label>
                                    <label class="dolar-option">
                                        <input type="radio" name="buy-dolar-type" value="oficial">
                                        <span class="dolar-option-label">
                                            <span class="dolar-name">Oficial</span>
                                            <span id="buy-dolar-oficial-value" class="dolar-value">-</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            <input type="number" id="buy-exchange-rate" min="0" step="0.01" required placeholder="Seleccioná una fecha">
                        </div>
                        <div class="form-group">
                            <label>Total Invertido</label>
                            <div class="calculated-value">
                                <span id="buy-total-ars"><span class="currency-label">ARS</span> 0</span>
                                <span id="buy-total-usd" class="calculated-usd">≈ <span class="currency-label">USD</span> 0.00</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary btn-full btn-buy">
                        <i class="fas fa-cart-plus"></i>
                        <span>Registrar Compra</span>
                    </button>
                </form>
                
                <!-- Formulario de VENTA -->
                <form id="sell-form" class="transaction-form hidden">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sell-stock-select">Acción a Vender</label>
                            <select id="sell-stock-select" required>
                                <option value="">Seleccionar de mis tenencias...</option>
                                <!-- Se llena dinámicamente con las acciones que el usuario tiene -->
                            </select>
                            <small id="sell-available-qty" class="available-qty"></small>
                        </div>
                        <div class="form-group">
                            <label for="sell-date">Fecha de Venta</label>
                            <input type="date" id="sell-date" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sell-quantity">Cantidad a Vender</label>
                            <input type="number" id="sell-quantity" min="0.01" step="0.01" required placeholder="Ej: 5">
                        </div>
                        <div class="form-group">
                            <label for="sell-price">Precio de Venta por Acción (ARS)</label>
                            <input type="number" id="sell-price" min="0" step="0.01" required placeholder="Ej: 18000">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sell-exchange-rate">Cotización USD del día</label>
                            <div id="sell-dolar-type-container" class="dolar-type-container hidden">
                                <div class="dolar-options">
                                    <label class="dolar-option">
                                        <input type="radio" name="sell-dolar-type" value="blue" checked>
                                        <span class="dolar-option-label">
                                            <span class="dolar-name">Blue</span>
                                            <span id="sell-dolar-blue-value" class="dolar-value">-</span>
                                        </span>
                                    </label>
                                    <label class="dolar-option">
                                        <input type="radio" name="sell-dolar-type" value="oficial">
                                        <span class="dolar-option-label">
                                            <span class="dolar-name">Oficial</span>
                                            <span id="sell-dolar-oficial-value" class="dolar-value">-</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            <input type="number" id="sell-exchange-rate" min="0" step="0.01" required placeholder="Seleccioná una fecha">
                        </div>
                        <div class="form-group">
                            <label>Total Venta / Ganancia</label>
                            <div class="calculated-value sell-calc">
                                <span id="sell-total-ars"><span class="currency-label">ARS</span> 0</span>
                                <span id="sell-profit" class="calculated-profit">G/P: <span class="currency-label">ARS</span> 0</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary btn-full btn-sell">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>Registrar Venta</span>
                    </button>
                </form>
            </div>
        </section>

        <!-- 4. MIS TENENCIAS -->
        <section class="holdings-section">
            <div class="container">
                <h2 class="section-title">
                    <i class="fas fa-wallet"></i>
                    Mis Tenencias
                </h2>
                <div class="table-container">
                    <table id="holdings-table" class="holdings-table compact">
                        <thead>
                            <tr>
                                <th>Acción</th>
                                <th>Cant.</th>
                                <th>Precio Compra (c/u)</th>
                                <th>Precio Actual (c/u)</th>
                                <th>G/P ARS</th>
                                <th>G/P USD</th>
                                <th>%</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="holdings-body">
                        </tbody>
                    </table>
                </div>
                <div id="no-holdings" class="empty-state hidden">
                    <i class="fas fa-inbox"></i>
                    <p>No tienes acciones registradas aún</p>
                    <p class="empty-hint">Agrega tu primera compra arriba</p>
                </div>
            </div>
        </section>

        <!-- 5. HISTORIAL DE COMPRAS/VENTAS -->
        <section class="transactions-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Historial de Operaciones
                    </h2>
                    <button id="toggle-history" class="btn-secondary">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div id="transactions-content" class="transactions-content collapsed">
                    <div class="table-container">
                        <table id="transactions-table" class="transactions-table compact">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Tipo</th>
                                    <th>Acción</th>
                                    <th>Cant.</th>
                                    <th>Total ARS</th>
                                    <th>USD</th>
                                    <th>G/P</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="transactions-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. ANÁLISIS DEL PORTFOLIO -->
        <section class="charts-section">
            <div class="container">
                <h2 class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    Análisis del Portfolio
                </h2>
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3>Distribución del Patrimonio</h3>
                        <div class="chart-container">
                            <canvas id="portfolio-pie-chart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Rendimiento por Acción</h3>
                        <div class="chart-container">
                            <canvas id="performance-bar-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. CALENDARIO DE INVERSIONES -->
        <section class="calendar-section">
            <div class="container">
                <h2 class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    Calendario de Inversiones
                </h2>
                <div class="calendar-controls">
                    <button id="prev-year" class="btn-icon"><i class="fas fa-chevron-left"></i></button>
                    <span id="calendar-year" class="calendar-year">2024</span>
                    <button id="next-year" class="btn-icon"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div id="calendar-grid" class="calendar-grid">
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <span class="legend-color buy-low"></span>
                        <span>Compra baja</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color buy-high"></span>
                        <span>Compra alta</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color sell"></span>
                        <span>Venta</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal detalle día -->
        <div id="day-detail-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="day-detail-title">Detalle del día</h3>
                    <button class="modal-close" onclick="closeDayModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="day-detail-content" class="day-detail-content">
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>Wealth Portfolio © 2024 | Gestiona tu patrimonio con elegancia</p>
        </div>
    </footer>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
